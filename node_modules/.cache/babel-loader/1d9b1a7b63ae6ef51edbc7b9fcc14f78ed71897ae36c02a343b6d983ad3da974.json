{"ast":null,"code":"import { EventSubscription } from '../common/EventEmitter.js';\nimport { debugError } from '../common/util.js';\nimport { assert } from '../util/assert.js';\nimport { DisposableStack } from '../util/disposable.js';\n/**\n * @internal\n */\nexport class PipeTransport {\n  #pipeWrite;\n  #subscriptions = new DisposableStack();\n  #isClosed = false;\n  #pendingMessage = '';\n  onclose;\n  onmessage;\n  constructor(pipeWrite, pipeRead) {\n    this.#pipeWrite = pipeWrite;\n    this.#subscriptions.use(new EventSubscription(pipeRead, 'data', buffer => {\n      return this.#dispatch(buffer);\n    }));\n    this.#subscriptions.use(new EventSubscription(pipeRead, 'close', () => {\n      if (this.onclose) {\n        this.onclose.call(null);\n      }\n    }));\n    this.#subscriptions.use(new EventSubscription(pipeRead, 'error', debugError));\n    this.#subscriptions.use(new EventSubscription(pipeWrite, 'error', debugError));\n  }\n  send(message) {\n    assert(!this.#isClosed, '`PipeTransport` is closed.');\n    this.#pipeWrite.write(message);\n    this.#pipeWrite.write('\\0');\n  }\n  #dispatch(buffer) {\n    assert(!this.#isClosed, '`PipeTransport` is closed.');\n    let end = buffer.indexOf('\\0');\n    if (end === -1) {\n      this.#pendingMessage += buffer.toString();\n      return;\n    }\n    const message = this.#pendingMessage + buffer.toString(undefined, 0, end);\n    if (this.onmessage) {\n      this.onmessage.call(null, message);\n    }\n    let start = end + 1;\n    end = buffer.indexOf('\\0', start);\n    while (end !== -1) {\n      if (this.onmessage) {\n        this.onmessage.call(null, buffer.toString(undefined, start, end));\n      }\n      start = end + 1;\n      end = buffer.indexOf('\\0', start);\n    }\n    this.#pendingMessage = buffer.toString(undefined, start);\n  }\n  close() {\n    this.#isClosed = true;\n    this.#subscriptions.dispose();\n  }\n}","map":{"version":3,"names":["EventSubscription","debugError","assert","DisposableStack","PipeTransport","pipeWrite","subscriptions","isClosed","pendingMessage","onclose","onmessage","constructor","pipeRead","use","buffer","dispatch","call","send","message","write","#dispatch","end","indexOf","toString","undefined","start","close","dispose"],"sources":["/Users/jeffreyvanoosterwijk/Desktop/repos/resume-generator/node_modules/puppeteer-core/src/node/PipeTransport.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2018 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport type {ConnectionTransport} from '../common/ConnectionTransport.js';\nimport {EventSubscription} from '../common/EventEmitter.js';\nimport {debugError} from '../common/util.js';\nimport {assert} from '../util/assert.js';\nimport {DisposableStack} from '../util/disposable.js';\n\n/**\n * @internal\n */\nexport class PipeTransport implements ConnectionTransport {\n  #pipeWrite: NodeJS.WritableStream;\n  #subscriptions = new DisposableStack();\n\n  #isClosed = false;\n  #pendingMessage = '';\n\n  onclose?: () => void;\n  onmessage?: (value: string) => void;\n\n  constructor(\n    pipeWrite: NodeJS.WritableStream,\n    pipeRead: NodeJS.ReadableStream\n  ) {\n    this.#pipeWrite = pipeWrite;\n    this.#subscriptions.use(\n      new EventSubscription(pipeRead, 'data', (buffer: Buffer) => {\n        return this.#dispatch(buffer);\n      })\n    );\n    this.#subscriptions.use(\n      new EventSubscription(pipeRead, 'close', () => {\n        if (this.onclose) {\n          this.onclose.call(null);\n        }\n      })\n    );\n    this.#subscriptions.use(\n      new EventSubscription(pipeRead, 'error', debugError)\n    );\n    this.#subscriptions.use(\n      new EventSubscription(pipeWrite, 'error', debugError)\n    );\n  }\n\n  send(message: string): void {\n    assert(!this.#isClosed, '`PipeTransport` is closed.');\n\n    this.#pipeWrite.write(message);\n    this.#pipeWrite.write('\\0');\n  }\n\n  #dispatch(buffer: Buffer): void {\n    assert(!this.#isClosed, '`PipeTransport` is closed.');\n\n    let end = buffer.indexOf('\\0');\n    if (end === -1) {\n      this.#pendingMessage += buffer.toString();\n      return;\n    }\n    const message = this.#pendingMessage + buffer.toString(undefined, 0, end);\n    if (this.onmessage) {\n      this.onmessage.call(null, message);\n    }\n\n    let start = end + 1;\n    end = buffer.indexOf('\\0', start);\n    while (end !== -1) {\n      if (this.onmessage) {\n        this.onmessage.call(null, buffer.toString(undefined, start, end));\n      }\n      start = end + 1;\n      end = buffer.indexOf('\\0', start);\n    }\n    this.#pendingMessage = buffer.toString(undefined, start);\n  }\n\n  close(): void {\n    this.#isClosed = true;\n    this.#subscriptions.dispose();\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}